{% extends 'communication/compose_email.html' %}

{% load static %}
{% load markdownify %}

{% block title %}All Templates{% endblock %}
{% block page_header %}All Templates{% endblock %}

{% block email_action %}
    <div>
        <div class="d-flex align-items-center p-3 border-bottom tx-16">
            <i class="fa fa-fw fa-envelope-open-text me-2"></i> Sent Email
        </div>
    </div>

    <div class="p-3 pb-0">
        <table class="table table-sm table-dark table-bordered">
            {% if emailhistory_list %}
                <tr>
                    <th width="20%">Subject</th>
                    <th width="40%">Message</th>
                    <th width="20%">Sent On</th>
                    <th width="20%">Sent By</th>
                </tr>
                {% for sent_email in emailhistory_list %}
                    <tr>
                        <td>{% if sent_email.subject|length > 30 %}<abbr title="{{ sent_email.subject }}">{% endif %}{{ sent_email.subject|truncatechars:30 }}</abbr></td>
                        <td>{% if sent_email.message|length > 50 %}<abbr title="{{ sent_email.message|truncatechars:200|markdownify }}">{% endif %}{{ sent_email.message|truncatechars:50|markdownify }}</abbr></td>
                        <td>{{ sent_email.timestamp|date:'m-d-Y h:i A' }}</td>
                        <td>{% if sent_email.user.first_name %}{{ sent_email.user.first_name }} {{ sent_email.user.last_name }}{% else %}{{ sent_email.user.username }}{% endif %}</td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td class="text-center">
                        The database doesn't lie... I can't find any emails that have been sent.<br />
                        Want to <a href="{% url 'emailCompose' %}">send an email?</a>
                    </td>
                </tr>
            {% endif %}
        </table>
    </div>
{% endblock %}